<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}HERSET å®˜æ–¹ç¶²ç«™ï½œå¤©ç„¶ä¿é¤Š Ã— å“å‘³ç”Ÿæ´»{% endblock %}</title>

  <!-- SEO -->
  <meta name="description" content="HERSET å°ˆæ³¨æ–¼ç§å¯†è­·ç†ã€èº«é«”ä¿é¤Šèˆ‡é¦™æ°›ï¼Œæ‰“é€ ç°¡ç´„è‡ªç„¶çš„ä¿é¤Šç”Ÿæ´»ç¾å­¸ã€‚">
  <meta name="keywords" content="HERSET, å¤©ç„¶ä¿é¤Š, ç§å¯†è™•æ¸…æ½”, èº«é«”ä¹³, é¦™æ°›, å“å‘³ç”Ÿæ´», ç¾å­¸å“ç‰Œ">

  <!-- Canonical -->
  <link rel="canonical" href="https://herset.co{{ request.path }}">

  <!-- âœ… Faviconï¼šä½¿ç”¨çµ•å°ç¶²å€é¿å…åœ–ç‰‡è®€ä¸åˆ° -->
  <link rel="icon" href="https://herset.co/static/uploads/logo_0.png" type="image/png">

  <!-- âœ… çµæ§‹åŒ–è³‡æ–™ï¼šå“ç‰Œ Logo ç”¨çµ•å°ç¶²å€è®“ Google èƒ½æŠ“åˆ° -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "HERSET",
    "url": "https://www.herset.co",
    "logo": "https://herset.co/static/uploads/logo_0.png"
  }
  </script>

  <!-- CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@500;700&family=Rubik:wght@500&display=swap" rel="stylesheet">


<!-- FBåƒç´ Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '2160093911138296');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=2160093911138296&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->



</head>


<body>

<div class="add-success" id="add-success">å·²åŠ å…¥è³¼ç‰©è»Šï¼</div>
<div class="save-success" id="save-success">è³‡æ–™å·²æ›´æ–°å®Œæˆï¼</div>

<!-- æ–°è¨Šæ¯æç¤º -->
{% if session.get('member_id') and session.get('has_new_reply') %}
<div style="background: #ffebee; color: #c62828; padding: 10px; text-align: center; font-weight: bold;">
  ğŸ“© æ‚¨æœ‰æ–°çš„ç•™è¨€å›è¦†ï¼Œè«‹å‰å¾€æœƒå“¡ä¸­å¿ƒæŸ¥çœ‹ã€‚
</div>
{% endif %}

<!-- å…¬å‘Šåˆ— -->

<!-- å°è¦½åˆ— -->
<header class="main-header">
  <a href="/" class="logo-area" style="text-decoration: none; color: inherit;">
    <img src="{{ url_for('static', filename='uploads/logo_0.png') }}" alt="logo">
    <span>HERSET</span>
  </a>

   {# åªåœ¨é¦–é é¡¯ç¤ºï¼›è‹¥æƒ³æ‰€æœ‰é é¢éƒ½é¡¯ç¤ºï¼ŒæŠŠé€™å€‹ if æ•´æ®µæ‹¿æ‰å³å¯ #}
  {% if request.path == '/' %}
    <div class="ann-ticker">
  <div class="ann-track">
    <span id="annA" class="ann-layer on"></span>
    <span id="annB" class="ann-layer"></span>
  </div>
</div>

  {% endif %}

  <nav class="main-nav">
    <ul>
      {% if has_new_reply %}
        <li>
          <a href="/member/messages" style="color: red;">ğŸ“© æœ‰æ–°ç•™è¨€</a>
        </li>
      {% endif %}

      <li><a href="/">HOME</a></li>

      {% if session.get('user') %}
        <li><a href="/message">å•†å“è©¢å•</a></li>
      {% endif %}

      {% if session.get('user') %}
        <li class="dropdown">
          <a href="#">ğŸ‘¤ æœƒå“¡ä¸­å¿ƒ</a>
          <ul class="dropdown-menu">
            <li><a href="/order-history">æ­·å²è¨‚å–®</a></li>
            <li><a href="#" id="open-profile-link">æœƒå“¡è³‡æ–™</a></li>
            <li><a href="/member/messages">ğŸ“¨ æˆ‘çš„ç•™è¨€</a></li>
            <li><a href="/change-password">ğŸ”’ ä¿®æ”¹å¯†ç¢¼</a></li>
            <li><a href="/logout">ç™»å‡º</a></li>
          </ul>
        </li>
      {% else %}
        <li><a href="/login">ğŸ‘¤ æœƒå“¡ç™»å…¥</a></li>
      {% endif %}

      <li>
        <a href="/cart" class="cart-btn">ğŸ›’ è³¼ç‰©è»Š
          {% if cart_count > 0 %}
            <span class="cart-count" id="cart-count">{{ cart_count }}</span>
          {% else %}
            <span class="cart-count" id="cart-count" style="display: none;">0</span>
          {% endif %}
        </a>
      </li>
    </ul>
  </nav>
</header>

{% if session.get('incomplete_profile') %}
<div id="incomplete-banner" style="background:#fff3f3;border:1px solid #f6c1c7;color:#a7334a;padding:10px 14px;margin:10px auto;max-width:1100px;border-radius:8px;display:flex;justify-content:space-between;align-items:center;gap:12px;">
  <div>ğŸ”” æ‚¨çš„æœƒå“¡è³‡æ–™å°šæœªå®Œæ•´ï¼ˆå§“åã€é›»è©±ã€åœ°å€ï¼‰ã€‚è«‹ç›¡å¿«è£œå¡«ä»¥ä¾¿é †åˆ©é…é€ã€‚</div>
  <div style="display:flex;gap:8px;">
    <button onclick="openProfileModal()" style="padding:8px 14px;border:none;border-radius:8px;background:#C6456C;color:#fff;font-weight:bold;cursor:pointer;">ç«‹å³è£œå¡«</button>
    <button onclick="document.getElementById('incomplete-banner').style.display='none'" style="padding:8px 12px;border:1px solid #d8b3b9;border-radius:8px;background:#fff;cursor:pointer;">ç¨å¾Œ</button>
  </div>
</div>
{% endif %}



<!-- è¼ªæ’­åœ–å€å¡Š -->
{% block banner %}
<div class="carousel-container">
  <div class="carousel">
    <img src="{{ url_for('static', filename='uploads/banner1.png') }}" class="carousel-img active">
    <img src="{{ url_for('static', filename='uploads/banner2.png') }}" class="carousel-img">
    <img src="{{ url_for('static', filename='uploads/banner3.jpg') }}" class="carousel-img">
    <img src="{{ url_for('static', filename='uploads/banner4.png') }}" class="carousel-img">
  </div>
  <div class="carousel-dots" id="carouselDots"></div>
</div>
{% endblock %}

<!-- å•†å“åˆ†é¡åˆ—ï¼ˆæ‰€æœ‰é é¢å…±ç”¨ï¼‰ -->
<div class="sub-categories" style="text-align: center; padding: 16px;">
  <a href="#" onclick="event.preventDefault(); loadCategory('å…¨éƒ¨')">å…¨éƒ¨å•†å“</a>
  <a href="#" onclick="event.preventDefault(); loadCategory('èº«é«”ä¿é¤Š')">èº«é«”ä¿é¤Š</a>
<a href="#" onclick="event.preventDefault(); loadCategory('ç”Ÿæ´»é¦™æ°›')">ç”Ÿæ´»é¦™æ°›</a>
<a href="#" onclick="event.preventDefault(); loadCategory('å¯µç‰©å‹å–„')">å¯µç‰©å‹å–„</a>
<a href="#" onclick="event.preventDefault(); loadCategory('å“ç‰Œåš´é¸')">å“ç‰Œåš´é¸</a>
<a href="#" onclick="event.preventDefault(); loadCategory('å¥—çµ„å„ªæƒ ')">å¥—çµ„å„ªæƒ </a>
</div>

<!-- ä¸»è¦å…§å®¹å€å¡Š -->
{% block content %}{% endblock %}



<!-- é å°¾ -->
<footer style="background: #f4d8cc; padding: 40px 20px; font-family: sans-serif; font-size: 14px;">
  <div style="display: flex; justify-content: space-around; flex-wrap: wrap; align-items: flex-start;">
    
    <!-- å·¦é‚Šæ¨™èª -->
    <div style="max-width: 300px; margin: 10px;">
      <h3 style="font-weight: bold;">
        Style should feel like home.<br>
        And home is not a place<br>
        -It's a feeling.
      </h3>
    </div>

    <!-- ä¸­é–“ç¤¾ç¾¤ -->
    <div style="min-width: 200px; margin: 10px;">
      <h4 style="margin-bottom: 10px;">é—œæ³¨æˆ‘å€‘</h4>
      <div style="display: flex; gap: 10px;">
        <a href="https://www.facebook.com/profile.php?id=61575912508195#" target="_blank">
          <img src="{{ url_for('static', filename='icons/facebook.png') }}" class="social-icon" alt="Facebook">
        </a>
        <a href="https://www.instagram.com/hello.herset?igsh=OHN2bHc2OGYxcXQ0&utm_source=qr" target="_blank">
          <img src="{{ url_for('static', filename='icons/instagram.png') }}" class="social-icon" alt="Instagram">
        </a>
        <a href="https://line.me/R/ti/p/@013ylkcz?oat_content=qr" target="_blank">
          <img src="{{ url_for('static', filename='icons/line.png') }}" class="social-icon" alt="LINE">
        </a>
        <a href="https://www.youtube.com/ä½ çš„é »é“ç¶²å€" target="_blank">
          <img src="{{ url_for('static', filename='icons/youtube.png') }}" class="social-icon" alt="YouTube">
        </a>
      </div>
    </div>

    <!-- å³é‚Šè¨‚è³¼å•é¡Œ -->
    <div style="min-width: 200px; margin: 10px;">
      <h4 style="margin-bottom: 10px;">è¨‚è³¼å•é¡Œ</h4>
      <ul style="list-style: none; padding: 0;">
        <li><a href="/about">é—œæ–¼æˆ‘å€‘</a></li>
        <li><a href="/payment">ä»˜æ¬¾æ–¹å¼</a></li>
        <li><a href="/delivery">é…é€æ–¹å¼</a></li>
        <li><a href="/return">é€€è²¨é€€æ¬¾</a></li>
        <li><a href="/contact">è¯çµ¡æˆ‘å€‘</a></li>
        <!--<li>ç”¢å“å¸¸è¦‹FAQ</li>-->
      </ul>
    </div>

    <!-- å³ä¸‹æ”¯ä»˜æ–¹å¼ -->
    <div style="min-width: 200px; margin: 10px; text-align: center;">
      <h4 style="margin-bottom: 10px;">æ”¯ä»˜æ–¹å¼</h4>
      <div style="display: flex; justify-content: center; gap: 10px;">
        <img src="{{ url_for('static', filename='icons/visa.png') }}" class="social-icon" alt="VISA">
        <img src="{{ url_for('static', filename='icons/linepay.png') }}" class="social-icon" alt="LINE PAY">
      </div>
    </div>
  </div>
</footer>

<!-- æœƒå“¡è³‡æ–™ Modal -->
<div id="profile-modal" class="modal" style="display:none;">

  <div class="modal-content profile-form">
    <span class="close-btn" onclick="closeProfileModal()">&times;</span>
    <h2>æœƒå“¡è³‡æ–™</h2>
    <form action="/profile" method="POST">
      <div class="form-group">
        <label for="name">å§“åï¼š</label>
        <input type="text" id="name" name="name" autocomplete="name" required>
      </div>
      <div class="form-group">
        <label for="phone">é›»è©±ï¼š</label>
        <input type="text" id="phone" name="phone" autocomplete="tel" required>
      </div>
      <div class="form-group">
        <label for="address">åœ°å€ï¼š</label>
        <input type="text" id="address" name="address" autocomplete="street-address" required>
      </div>
      <div class="form-group">
        <label for="note">è¨‚å–®å‚™è¨»ï¼š</label>
        <textarea id="note" name="note" rows="3"></textarea>
      </div>
      <div style="text-align:center; margin-top: 20px;">
        <button type="submit" class="save-btn">å„²å­˜è³‡æ–™</button>
      </div>
    </form>
  </div>
</div>

<!-- æœªå„²å­˜ç¢ºèª -->
<div id="unsaved-warning" class="modal">
  <div class="modal-content" style="text-align:center;">
    <h3>âš ï¸ å°šæœªå„²å­˜è®Šæ›´</h3>
    <p>æ‚¨å°šæœªå„²å­˜è³‡æ–™ï¼Œç¢ºå®šè¦é—œé–‰å—ï¼Ÿ</p>
    <div style="margin-top: 20px;">
      <button onclick="cancelCloseProfile()">å–æ¶ˆ</button>
      <button onclick="confirmCloseProfile()">ç¢ºå®šé—œé–‰</button>
    </div>
  </div>
</div>


<script src="{{ url_for('static', filename='script.js') }}"></script>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const link = document.getElementById('open-profile-link');
    if (link) {
      link.addEventListener('click', (e) => {
        e.preventDefault();     // é˜»æ­¢ # æ²åˆ°é é ‚æˆ–æ”¶åˆè¡çª
        e.stopPropagation();
        openProfileModal();     // é–‹å•Ÿæœƒå“¡è³‡æ–™
      });
    }
  });
</script>

<script>
  // åªæœ‰ã€Œç¬¬ä¸€æ¬¡ç™»å…¥å¾Œã€ç¬¬ä¸€æ¬¡è¼‰å…¥é é¢ã€è‡ªå‹•å½ˆå‡ºä¸€æ¬¡
  window.addEventListener('DOMContentLoaded', () => {
  const needFill = {{ 'true' if session.get('incomplete_profile') else 'false' }};
  const shown = sessionStorage.getItem('profileModalShown') === '1';
  if (needFill && !shown) {
    setTimeout(() => {
      const modal = document.getElementById('profile-modal');
      if (modal && modal.style.display !== 'block') {
        try {
          openProfileModal();
          sessionStorage.setItem('profileModalShown', '1'); // â† åªæ¨™è¨˜ä¸€æ¬¡
        } catch (_) {}
      }
    }, 400);
  }
});

</script>

<!-- å…¬å‘Šæ¢ -->
<script>
(function () {
  const A = document.getElementById('annA');
  const B = document.getElementById('annB');
  if (!A || !B) return;                       // ä¸æ˜¯é¦–é å°±ä¸è·‘

  const API = '/announcements.json';          // ç›®å‰ç«™ä¸Šå¯ç”¨çš„ç«¯é»
  const INTERVAL = 5000;                      // 3 ç§’ä¸€å‰‡ï¼ˆå‘¼å¸æ„Ÿï¼‰å…¬å‘Šé€Ÿåº¦

  const pickText = (a) => {
    const t = (a?.title || '').trim();
    const c = (a?.content || '').trim();
    return (t && c) ? `${t}ï½œ${c}` : (t || c);
  };
  const normalize = (raw) =>
    Array.isArray(raw) ? raw : (raw?.items || raw?.data || []);

  fetch(API, { credentials: 'same-origin' })
    .then(r => r.ok ? r.json() : [])
    .then(json => normalize(json).map(pickText).filter(Boolean))
    .then(items => {
      if (!items.length) { A.textContent = ''; return; }

      let i = 0, flip = false;
      A.textContent = items[0];
      A.classList.add('on');

      if (items.length === 1) return;         // åªæœ‰ä¸€å‰‡å°±å¸¸é§ä¸åˆ‡æ›

      setInterval(() => {
        const next = items[(i + 1) % items.length];
        if (flip) {
          // é¡¯ç¤º A
          A.textContent = next;
          A.classList.add('on');
          B.classList.remove('on');
        } else {
          // é¡¯ç¤º B
          B.textContent = next;
          B.classList.add('on');
          A.classList.remove('on');
        }
        i = (i + 1) % items.length;
        flip = !flip;
      }, INTERVAL);
    })
    .catch(() => { /* éœé»˜å¤±æ•— */ });
})();
</script>





<script>
let initialProfileData = {};
let pendingClose = false;

async function openProfileModal() {
  const modal = document.getElementById("profile-modal");
  if (!modal) return;

  // å…ˆæ‰“é–‹ï¼Œè®“ä½¿ç”¨è€…æœ‰æ„Ÿï¼ˆå³ä½¿è³‡æ–™æŠ“ä¸åˆ°ä¹Ÿæœƒå†é—œæ‰ä¸¦å°å‘ï¼‰
  modal.style.display = "block";

  try {
    const res = await fetch('/get_profile', { credentials: 'same-origin' });

    // é 2xx æˆ–è¢« 302 å°åˆ° HTMLï¼ˆé JSONï¼‰
    if (!res.ok) throw new Error('not-ok');
    const ct = res.headers.get('content-type') || '';
    if (!ct.includes('application/json')) throw new Error('not-json');

    const data = await res.json();

    document.getElementById("name").value    = data.name    || '';
    document.getElementById("phone").value   = data.phone   || '';
    document.getElementById("address").value = data.address || '';
    document.getElementById("note").value    = data.note    || '';

    // âœ…ã€æ–°å¢ã€‘æ‰“é–‹å¾Œè‡ªå‹•èšç„¦åˆ°ç¬¬ä¸€å€‹ç©ºæ¬„ä½
  const order = ["name","phone","address"];
  const target = order.find(id => !(document.getElementById(id).value || '').trim()) || "name";
  document.getElementById(target).focus();

    // ç´€éŒ„åˆå§‹å€¼ä¾›é—œé–‰æ™‚æ¯”å°
    window.initialProfileData = {
      name:    (data.name    || '').trim(),
      phone:   (data.phone   || '').trim(),
      address: (data.address || '').trim()
    };
  } catch (e) {
    // é—œæ‰ modal â†’ å°å‘ç™»å…¥ï¼ˆå¸¶ nextï¼‰
    modal.style.display = "none";
    window.location.href = '/login?next=profile';
  }
}

function closeProfileModal() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();

  const isFirstLogin =
    !initialProfileData.name && !initialProfileData.phone && !initialProfileData.address;

  if (isFirstLogin && (!name || !phone || !address)) {
    setTimeout(() => {
      document.querySelector(".profile-form form").reportValidity();
    }, 10);
    return;
  }

  const changed =
    name !== initialProfileData.name ||
    phone !== initialProfileData.phone ||
    address !== initialProfileData.address;

  if (changed) {
    pendingClose = true;
    document.getElementById("unsaved-warning").style.display = "block";
  } else {
    document.getElementById("profile-modal").style.display = "none";
  }
}

function confirmCloseProfile() {
  if (pendingClose) {
    document.getElementById("unsaved-warning").style.display = "none";
    document.getElementById("profile-modal").style.display = "none";
    pendingClose = false;
  }
}

function cancelCloseProfile() {
  document.getElementById("unsaved-warning").style.display = "none";
  pendingClose = false;
}
</script>


<script>
  // åªåœ¨ã€Œé»åˆ°èƒŒæ™¯ï¼ˆä¸æ˜¯å…§å®¹ï¼‰ã€æ™‚æ‰å˜—è©¦é—œé–‰
(function () {
  const modal = document.getElementById('profile-modal');
  if (!modal) return;

  const content = modal.querySelector('.modal-content');

  // åªåœ¨ã€Œmousedown ç™¼ç”Ÿåœ¨èƒŒæ™¯ã€ï¼Œä¸”ã€Œmouseup ä¹Ÿåœ¨èƒŒæ™¯ã€ï¼Œè€Œä¸”ã€Œå¹¾ä¹æ²’ç§»å‹•ã€æ™‚æ‰é—œé–‰
  let backdropDown = false;
  let downX = 0, downY = 0;

  modal.addEventListener('mousedown', (e) => {
    // åªæœ‰çœŸçš„é»åˆ°é®ç½©æ‰è¨˜æ——æ¨™
    if (e.target === modal) {
      backdropDown = true;
      downX = e.clientX;
      downY = e.clientY;
    } else {
      backdropDown = false;
    }
  });

  modal.addEventListener('mouseup', (e) => {
    if (!backdropDown) return;          // mousedown ä¸æ˜¯åœ¨èƒŒæ™¯ â†’ ä¸é—œ
    backdropDown = false;

    // æ»‘é¼ ç§»å‹•å¤ªå¤š(å¤§æ–¼ 5px) è¦–ç‚ºæ‹–æ›³ï¼Œä¸é—œ
    const moved = Math.abs(e.clientX - downX) + Math.abs(e.clientY - downY) > 5;

    if (e.target === modal && !moved) {
      closeProfileModal();
    }
  });

  // å…§å®¹å€é˜»æ­¢å†’æ³¡ï¼Œé¿å…èª¤åˆ¤
  if (content) {
    content.addEventListener('mousedown', (e) => e.stopPropagation());
    content.addEventListener('mouseup', (e) => e.stopPropagation());
  }
})();


  // âœ… æŒ‰ ESC é—œé–‰
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeProfileModal();
  });
</script>

<!-- æ””æˆªã€Œæœƒå“¡è³‡æ–™ã€è¡¨å–®æäº¤ï¼Œæ”¹ç”¨ fetch é€å‡º -->
 <script>
// æœƒå“¡è³‡æ–™è¡¨å–® AJAX æäº¤
window.addEventListener('DOMContentLoaded', () => {
  const form = document.querySelector('#profile-modal form');
  if (!form) return;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    // ç°¡å–®å‰ç«¯é©—è­‰
    if (!form.reportValidity()) return;

    const fd = new FormData(form);
    const body = new URLSearchParams();
    for (const [k, v] of fd.entries()) body.append(k, v);

    try {
      const res = await fetch('/profile', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body
      });

      // å…è¨±å¾Œç«¯å› 200 JSON æˆ– 302 redirectï¼›è‹¥é 2xx è¦–ç‚ºå¤±æ•—
      if (!res.ok) throw new Error('bad-status');

      // å˜—è©¦è§£æ JSONï¼ˆè‹¥å¾Œç«¯æ”¹æˆ redirect ä¹Ÿä¸æœƒå£ï¼‰
      let json = {};
      try { json = await res.json(); } catch (_) {}

      if (json.success === false) throw new Error(json.message || 'update-failed');

      // âœ… æˆåŠŸï¼šé—œé–‰ Modalã€ç§»é™¤å¼•å°æ¢ã€é¡¯ç¤ºæˆåŠŸæç¤º
      document.getElementById('profile-modal').style.display = 'none';

      const banner = document.getElementById('incomplete-banner');
      if (banner) banner.style.display = 'none';

      const toast = document.getElementById('toast-message') || document.getElementById('save-success');
      if (toast) {
        // è‹¥æ˜¯ toast-messageï¼šèµ°ä½ æ—¢æœ‰çš„æ¨£å¼
        if (toast.id === 'toast-message') {
          toast.textContent = 'æœƒå“¡è³‡æ–™å·²æ›´æ–°å®Œæˆ';
          toast.style.display = 'block';
          toast.style.backgroundColor = '#c08474';
          setTimeout(() => {
            toast.style.opacity = 0;
            setTimeout(() => { toast.style.display = 'none'; toast.style.opacity = 1; }, 1000);
          }, 3000);
        } else {
          // é é¦–å›ºå®šçš„ save-success æç¤ºæ–¹å¡Š
          toast.style.display = 'block';
          setTimeout(() => { toast.style.display = 'none'; }, 1800);
        }
      }

      // æ›´æ–°åˆå§‹å€¼ï¼Œé¿å…ç«‹åˆ»é—œé–‰æ™‚è¢«ç•¶æˆã€Œæœªå„²å­˜è®Šæ›´ã€
      window.initialProfileData = {
        name: (document.getElementById('name').value || '').trim(),
        phone: (document.getElementById('phone').value || '').trim(),
        address: (document.getElementById('address').value || '').trim()
      };

    } catch (err) {
      alert('å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
    }
  });
});
</script>

<script>
  // é»ç™»å‡ºæ‰æ¸…é™¤ï¼Œåªåœ¨ä¸‹ä¸€æ¬¡ç™»å…¥æ™‚å†å½ˆå‡º
  window.addEventListener('DOMContentLoaded', () => {
    const logoutLink = document.querySelector('a[href="/logout"]');
    if (logoutLink) {
      logoutLink.addEventListener('click', () => {
        try { sessionStorage.removeItem('profileModalShown'); } catch (_) {}
      });
    }
  });
</script>


<script>
function loadCategory(categoryName) {
  const hasProductContainer = document.querySelector('#product-container');
  const targetUrl = '/?category=' + encodeURIComponent(categoryName);

  if (!hasProductContainer) {
    window.location.href = targetUrl;
    return;
  }

  fetch(targetUrl)
    .then(response => response.text())
    .then(html => {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = html;
      const newContent = tempDiv.querySelector('#product-container');
      if (!newContent) return;

      const currentContent = document.querySelector('#product-container');
      currentContent.innerHTML = newContent.innerHTML;

        // âœ… é€™è£¡ç›´æ¥åœ¨å‰ç«¯åšç¯©é¸ï¼ˆåŒ…å«ã€Œå¥—çµ„å„ªæƒ ã€ï¼‰
      const cards = currentContent.querySelectorAll('.product-card');
      cards.forEach(el => {
        const cats = (el.dataset.category || '').split(',').map(s => s.trim());
        const type = (el.dataset.type || '').trim(); // single / bundle

        let show = false;
        if (categoryName === 'å…¨éƒ¨' || categoryName === 'å…¨éƒ¨å•†å“') {
          show = true;
        } else if (categoryName === 'å¥—çµ„å„ªæƒ ') {
          show = (type === 'bundle');
        } else {
          show = cats.includes(categoryName);
        }
        el.style.display = show ? 'block' : 'none';
      });

      // åˆ‡æ› active æ¨£å¼
      document.querySelectorAll('.sub-categories a').forEach(a => {
        a.classList.toggle('active', a.textContent.trim() === categoryName);
      });

      history.replaceState(null, '', targetUrl);
    })
    .catch(err => {
      console.error('è¼‰å…¥åˆ†é¡å¤±æ•—:', err);
    });
}

// âœ… åˆå§‹åŒæ­¥ç›®å‰åˆ†é¡æ¨£å¼
window.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const category = params.get('category') || 'å…¨éƒ¨';
  document.querySelectorAll('.sub-categories a').forEach(a => {
    a.classList.toggle('active', a.textContent.trim() === category);
  });
});


</script>

<!-- ç•™è¨€é€å‡ºæˆåŠŸæç¤º -->
<div id="toast-message" class="toast" style="display: none;"></div>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const toast = document.getElementById('toast-message');
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        const [category, message] = {{ messages[0]|tojson }};
        toast.textContent = message;
        toast.style.display = 'block';
        toast.style.backgroundColor = category === 'success' ? '#c08474' : '#e91e63';

        setTimeout(() => {
          toast.style.opacity = 0;
          setTimeout(() => { toast.style.display = 'none'; toast.style.opacity = 1; }, 1000);
        }, 3000);
      {% endif %}
    {% endwith %}
  });
</script>




{% block script %}{% endblock %}
</body>
</html>
