<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>購物車 - HERSET BEAUTY</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { background-color: #f9f5f5; }
    .cart-container {
      max-width: 900px; margin: 40px auto; background: #fff; padding: 30px;
      border-radius: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    .member-info {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 20px; font-size: 16px; color: #5A4B45;
    }
    .member-info .account { font-weight: bold; color: #CDAFA1; margin-left: 4px; }
    .member-info .right { margin-left: auto; }
    .login-btn {
      background: #CDAFA1; color: white; border: none; border-radius: 6px;
      padding: 6px 14px; font-weight: bold; text-decoration: none;
    }
    h2 { color: #3C3C3C; margin-bottom: 20px; }
    .cart-item {
      display: flex; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0;
    }
    .cart-item img {
      width: 80px; height: 80px; object-fit: cover; margin-right: 20px;
      border-radius: 6px; border: 1px solid #ddd;
    }
    .cart-info { flex: 1; }
    .cart-actions { display: flex; gap: 6px; align-items: center; }
    .cart-actions form { display: inline; }
    .cart-actions button {
      padding: 5px 10px; font-size: 15px; border: 1px solid #ccc;
      background-color: white; border-radius: 5px; cursor: pointer;
    }
    .cart-actions button:hover { background-color: #eee; }

    /* 折扣碼輸入區 */
    .coupon-box{
      margin-top:20px; padding:16px; border:1px dashed #e5e7eb; border-radius:10px; background:#fafafa;
      display:flex; gap:12px; align-items:center; flex-wrap:wrap;
    }
    .coupon-box input[type="text"]{
      padding:10px 12px; border:1px solid #ddd; border-radius:8px; outline:none;
      font-size:15px; width:240px; max-width:100%;
    }
    .btn{ display:inline-flex; align-items:center; gap:6px; padding:10px 14px; border-radius:8px; border:none; cursor:pointer; font-weight:800; }
    .btn-primary{ background:#e91e63; color:#fff; }
    .btn-gray{ background:#f3f4f6; color:#111827; border:1px solid #e5e7eb; }
    .badge{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      background:#ffe4ed; color:#e91e63; font-weight:900; letter-spacing:1px;
    }
    .coupon-hint{ color:#6b7280; font-size:13px; }

    .total {
      text-align: right; font-size: 1.1rem; margin-top: 20px; color: #3C3C3C;
      line-height:1.9;
    }
    .total strong{ font-size:1.4rem; }
    .checkout-btn {
      margin-top: 20px; background-color: #e91e63; color: white; padding: 12px 24px;
      border: none; border-radius: 6px; font-size: 16px; font-weight: bold; float: right; cursor: pointer;
    }
    .checkout-btn:hover { background-color: #d81b60; }
    .back-btn { display: inline-block; margin-top: 40px; color: #5A4B45; text-decoration: none; font-weight: bold; }
    .back-btn:hover { text-decoration: underline; }
    .flash-message {
      background-color: #ffe6e6; color: #c00; padding: 10px; margin: 10px 0; border-radius: 5px;
    }

    .opt-label { color:#666; font-size:13px; margin-top:4px; }
    .opt-lines  { margin:4px 0 8px 0; padding-left:18px; color:#444; font-size:14px; line-height:1.7; list-style: disc; }
    .opt-line   { margin:0 0 2px 0; }

/* 寄送資訊樣式（緊湊版，姓名/電話固定較小） */
.ship-card{
  margin-top:18px;background:#fff;border:1px solid #eee;border-radius:12px;
  padding:14px 16px;box-shadow:0 4px 12px rgba(0,0,0,.04)
}
.ship-head{display:flex;justify-content:space-between;align-items:center}
.ship-title{font-weight:800;color:#5a4b45;display:flex;align-items:center;gap:8px}

/* 按鈕小一號 */
.ship-edit-btn{
  border:1px solid #e5e7eb;background:#fff;border-radius:8px;padding:6px 10px;
  cursor:pointer;display:inline-flex;align-items:center;gap:6px;color:#5a4b45;font-size:14px
}
.ship-edit-btn:hover{background:#fbf7f5}

.ship-display{margin-top:10px;line-height:1.7;color:#3c3c3c}

/* === 上排「收件人 / 電話」排版（更穩、更有間距） === */
:root{
  --ship-col-gap: 20px;      /* 兩欄間距：想再寬改這裡即可 */
  --ship-name-max: 340px;    /* 姓名欄最大寬 */
  --ship-phone-max: 220px;   /* 電話欄最大寬 */
  --ship-name-min: 220px;    /* 姓名欄最小寬，避免擠太窄 */
  --ship-phone-min: 140px;   /* 電話欄最小寬，避免擠太窄 */
}

.ship-grid{
  display: grid;
  /* 姓名 / 電話 / 右側留白（讓地址下一行能吃滿） */
  grid-template-columns:
    minmax(var(--ship-name-min),  var(--ship-name-max))
    minmax(var(--ship-phone-min), var(--ship-phone-max))
    1fr;
  column-gap: var(--ship-col-gap);
  row-gap: 10px;
  align-items: end;
  justify-content: start;
  justify-items: start;
}
.ship-field{ min-width: 0; } /* 防止內容把格子撐爆 */

/* 直接鎖定對應欄位最大寬（最穩） */
.ship-grid .ship-input[name="name"]  { max-width: var(--ship-name-max); }
.ship-grid .ship-input[name="phone"] { max-width: var(--ship-phone-max); }

/* 手機改回單欄（欄距自動不影響） */
@media (max-width:640px){
  .ship-grid{
    grid-template-columns: 1fr;
    column-gap: 0;
  }
  .ship-grid .ship-input[name="name"],
  .ship-grid .ship-input[name="phone"]{
    max-width: 100%;
  }
}

/* 標籤緊湊 */
.ship-field label{
  display:block;
  margin-bottom:4px;
  color:#7a6c66;
  font-weight:700;
  font-size:12px;
}

/* 輸入框外觀（地址保持全寬） */
.ship-input{
  width:100%;
  height:38px;
  padding:6px 10px;
  border:1px solid #eaded7;
  border-radius:8px;
  background:#fff;
  box-shadow:inset 0 1px 0 rgba(0,0,0,.02);
  font-size:14px;
  color:#3b2f2a;
  line-height:1.3;
  transition:border-color .15s, box-shadow .15s;
}
.ship-input::placeholder{ color:#b8a8a1; }
.ship-input:focus{
  outline:none;
  border-color:#e9b6c2;
  box-shadow:0 0 0 2px rgba(233,30,99,.12);
}

/* checkbox / 按鈕 */
.ship-checkbox{
  display:inline-flex;
  align-items:center;
  gap:8px;
  margin-top:8px;
  color:#6b7280;
  font-size:14px;
}
.ship-actions{ margin-top:10px; display:flex; gap:8px; }
.ship-btn-primary{
  background:#e91e63; color:#fff; border:none; border-radius:8px;
  padding:8px 14px; font-weight:800; cursor:pointer; font-size:14px;
}
.ship-btn-secondary{
  background:#fff; border:1px solid #e5e7eb; border-radius:8px;
  padding:8px 14px; cursor:pointer; font-size:14px;
}
.ship-btn-secondary:hover{ background:#fbf7f5; }


/* 右上角「繼續購物」 */
.continue-btn{
  background:#fff; color:#5A4B45; border:1px solid #eaded7;
  border-radius:999px; padding:8px 14px; font-weight:800;
  text-decoration:none; display:inline-flex; align-items:center; gap:6px;
}
.continue-btn:hover{ background:#fbf7f5; border-color:#e9b6c2; }
@media (max-width:480px){
  .continue-btn{ padding:6px 10px; font-size:14px; }
}

/* ==== 加購區（免運進度與推薦） ==== */
.upsell { margin-top:18px; padding:16px; border:1px solid #eee; border-radius:12px; background:#fff7f9; }
.upsell-head { display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:10px; }
.upsell-title { font-weight:800; color:#5a4b45; display:flex; align-items:center; gap:8px; }
.upsell-tip { color:#a33; font-size:14px; font-weight:700; }
.upsell-ok { color:#0a8a4b; font-size:14px; font-weight:700; }
.upsell-bar { height:10px; background:#ffe3ec; border-radius:999px; overflow:hidden; margin:6px 0 12px; }
.upsell-bar > div { height:100%; background:#e91e63; width:0%; }

.upsell-rail { position:relative; }
.upsell-scroller {
  display:flex; gap:12px; overflow-x:auto; padding:8px 4px 2px;
  scroll-snap-type:x proximity; -webkit-overflow-scrolling:touch;
  scrollbar-width:thin; flex-wrap: nowrap;                 /* ← 新增這行，強制單行橫滑 */
  mask-image: linear-gradient(to right, transparent 0, black 24px, black calc(100% - 24px), transparent 100%);
}

.upsell-card {
  flex:0 0 260px; /* 卡片寬度 */
  scroll-snap-align:start;
  display:flex; gap:10px; padding:12px; border:1px solid #f0d7df; border-radius:12px; background:#fff;
}
.upsell-card img {
  width:64px; height:64px; object-fit:cover; border-radius:8px; border:1px solid #eee;
}
.upsell-card .name { font-size:14px; color:#3c3c3c; font-weight:700; line-height:1.4; }
.upsell-card .price { margin-top:4px; font-weight:800; color:#e91e63; }
.upsell-card form { margin-top:auto; }
.upsell-add-btn {
  background:#e91e63; color:#fff; border:none; border-radius:999px; padding:6px 12px; cursor:pointer; font-size:13px; font-weight:800;
}

.upsell-nav {
  position:absolute; top:50%; transform:translateY(-50%);
  width:34px; height:34px; border-radius:999px; border:1px solid #e5e7eb;
  background:#fff; box-shadow:0 4px 10px rgba(0,0,0,.06);
  display:none; align-items:center; justify-content:center; cursor:pointer;
}
.upsell-nav:hover{ background:#fbf7f5; }
.upsell-nav.left{ left:-8px; }
.upsell-nav.right{ right:-8px; }

/* 螢幕夠寬再顯示左右箭頭 */
@media (min-width: 900px){
  .upsell-nav{ display:flex; }
}

/* 手機：卡片窄一點 */
@media (max-width: 480px){
  .upsell-card{ flex-basis: 220px; }
}


</style>

<!-- FB像素Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '2160093911138296');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=2160093911138296&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

</head>
<body>
  <div class="cart-container">
    <h2>🛒 我的購物車</h2>

    <div class="member-info">
  {% if session.member_id %}
    {% set display_name = (session.user.get('name') 
                           or session.user.get('username') 
                           or session.user.get('account') 
                           or session.user.get('email') 
                           or '會員') %}
    <div class="left">您好：<span class="account">{{ display_name }}</span></div>
    <div class="right">
      <a class="continue-btn" href="/">← 繼續購物</a>
    </div>
  {% else %}
    <div class="left">您尚未登入會員，請先登入會員才可結帳。</div>
    <div class="right" style="display:flex; gap:8px;">
      <a class="login-btn" href="/login?next=cart">登入會員</a>
      <a class="continue-btn" href="/">← 繼續購物</a>
    </div>
  {% endif %}
</div>



    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-message">
          {% for message in messages %}
            <p>{{ message }}</p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    {% if products %}
      {% for p in products %}
        <div class="cart-item">
          {% set cover = p.get('image') %}
          {% if not cover and p.get('images') and p['images']|length > 0 %}
            {% set cover = p['images'][0] %}
          {% endif %}
          <img src="{{ cover or url_for('static', filename='placeholder.png') }}"
               alt="{{ p['name'] }}"
               onerror="this.src='{{ url_for('static', filename='placeholder.png') }}'">

          <div class="cart-info">
            <strong>{{ p['name'] }}</strong><br>
            {# 🔹 顯示套組/選項內容（同時支援套組與單品） #}
{% if p['product_type'] == 'bundle' %}
  <div class="opt-label">套組內容</div>
  <ul class="opt-lines">
    {% if p.get('bundle_lines') and p['bundle_lines']|length > 0 %}
      {% for line in p['bundle_lines'] %}
        <li class="opt-line">{{ line }}</li>
      {% endfor %}
    {% elif p.get('option') %}
      <li class="opt-line">{{ p['option'] }}</li>
    {% endif %}
  </ul>
{% endif %}


{% if p.get('option') and p['product_type'] != 'bundle' %}
  <div class="opt-label">選項：</div>
  <div class="opt-lines">
    <span class="opt-line">・{{ p['option'] }}</span>
  </div>
{% endif %}


            {# ---- 價格計算（同時支援套組與單品）---- #}
            {% set is_bundle = (p.get('product_type') == 'bundle') %}
            {% set unit_price = (p.get('bundle_price') or p.get('discount_price') or p['price']) | float %}
            {% set unit_compare = (p.get('bundle_compare') or p.get('compare_at') or p.get('original_price') or p['price']) | float %}
            {% set qty = (p.get('qty') or 1) | int %}

            {% if unit_price < unit_compare and unit_compare > 0 %}
              <span style="color:#999; text-decoration: line-through;">${{ '%.0f' % unit_compare }}</span>
              <span style="color:#e91e63; font-weight:bold;">${{ '%.0f' % unit_price }}</span>
              × {{ qty }} =
              <span style="color:#e91e63; font-weight:bold;">${{ '%.0f' % (unit_price * qty) }}</span>
            {% else %}
              ${{ '%.0f' % unit_price }} × {{ qty }} = ${{ '%.0f' % (unit_price * qty) }}
            {% endif %}

            <div style="font-size:12px; color:#aaa;">
              原始售價: {{ '%.0f' % unit_compare }} /
              折扣價: {{ '%.0f' % (unit_price if unit_price < unit_compare else 0) }}
            </div>
          </div>

          <div class="cart-actions">
            <form method="POST">
              <input type="hidden" name="product_id" value="{{ p['id'] }}">
              <input type="hidden" name="option" value="{{ p.get('option','') }}">
              <input type="hidden" name="action" value="decrease">
              <button type="submit">−</button>
            </form>
            <form method="POST">
              <input type="hidden" name="product_id" value="{{ p['id'] }}">
              <input type="hidden" name="option" value="{{ p.get('option','') }}">
              <input type="hidden" name="action" value="increase">
              <button type="submit">＋</button>
            </form>
            <form method="POST">
              <input type="hidden" name="product_id" value="{{ p['id'] }}">
              <input type="hidden" name="option" value="{{ p.get('option','') }}">
              <input type="hidden" name="action" value="remove">
              <button type="submit">🗑️ 移除</button>
            </form>
          </div>
        </div>
      {% endfor %}

      <!-- 折扣碼輸入區 -->
      <form method="POST" class="coupon-box">
        <strong>折扣碼</strong>
        <input type="text" name="discount_code" placeholder="輸入折扣碼" value="{{ (discount.code if discount) or '' }}" />
        <input type="hidden" name="action" value="{{ 'remove_discount' if discount else 'apply_discount' }}">
        {% if discount %}
          <span class="badge">{{ discount.code }}</span>
          <button type="submit" class="btn btn-gray">取消</button>
        {% else %}
          <button type="submit" class="btn btn-primary">套用</button>
          <span class="coupon-hint">可於此輸入活動折扣碼；若未達門檻或逾期，系統會提示原因。</span>
        {% endif %}
      </form>

{# ==== 加購就免運（若還差金額 > 0 才顯示推薦） ==== #}
{% set threshold = free_shipping_threshold | default(0, true) %}
{% set remain    = free_shipping_diff       | default(0, true) %}
{% set cart_total = total - (discount_deduct or 0) %}
{% set progress = (cart_total / threshold * 100) if threshold > 0 else 100 %}
{% set progress = 100 if progress > 100 else (0 if progress < 0 else progress) %}

<div class="upsell">
  <div class="upsell-head">
    <div class="upsell-title">🛍️ 加購推薦</div>
    {% if remain > 0 %}
      <div class="upsell-tip">還差 <strong>${{ "{:,.0f}".format(remain) }}</strong> 即可享免運</div>
    {% else %}
      <div class="upsell-ok">已達免運門檻 🎉</div>
    {% endif %}
  </div>

  {# 免運進度條 #}
  {% if threshold > 0 %}
    <div style="display:flex;justify-content:space-between;font-size:12px;color:#777;">
      <span>目前：${{ "{:,.0f}".format(cart_total) }}</span>
      <span>免運門檻：${{ "{:,.0f}".format(threshold) }}</span>
    </div>
    <div class="upsell-bar"><div style="width: {{ '%.0f' % progress }}%;"></div></div>
  {% endif %}

  {# 只有「未達免運」時才顯示推薦商品 #}
  {% if remain > 0 and upsell_products and upsell_products|length > 0 %}
    <div class="upsell-rail">
  <button type="button" class="upsell-nav left" id="upsell-prev">‹</button>
  <div class="upsell-scroller" id="upsell-scroller">
    {% for u in upsell_products %}
      {% set up = (u.get('discount_price') or u.get('price') or 0) | float %}
      <div class="upsell-card">
        {% set cover = u.get('image') or (u.get('images')[0] if u.get('images') else None) %}
        <img src="{{ cover or url_for('static', filename='placeholder.png') }}"
             onerror="this.src='{{ url_for('static', filename='placeholder.png') }}'"
             alt="{{ u.get('name') or '' }}">
        <div style="display:flex; flex-direction:column; flex:1;">
          <div class="name">{{ u.get('name') }}</div>
          <div class="price">${{ '%.0f' % up }}</div>
          <form method="POST" action="/add_to_cart">
            <input type="hidden" name="product_id" value="{{ u.get('id') }}">
            <input type="hidden" name="qty" value="1">
            <input type="hidden" name="next" value="cart">
            <button type="submit" class="upsell-add-btn">＋ 加入購物車</button>
          </form>
        </div>
      </div>
    {% endfor %}
  </div>
  <button type="button" class="upsell-nav right" id="upsell-next">›</button>
</div>

  {% endif %}
</div>


      <!-- 寄送資訊（顯示 + 可展開編輯；需已登入） -->
{% if session.member_id %}
  {# 先準備顯示資料：優先用本次結帳暫存的 checkout_address，其次用 session.user #}
  {% set u = session.get('user', {}) %}
  {% set ship_name  = (checkout_address.name    if checkout_address else None) or (u.get('name') or u.get('username') or u.get('account') or '') %}
  {% set ship_phone = (checkout_address.phone   if checkout_address else None) or (u.get('phone') or '') %}
  {% set ship_addr  = (checkout_address.address if checkout_address else None) or (u.get('address') or '') %}

  <div class="ship-card">
  <div class="ship-head">
    <div class="ship-title">📦 寄送資訊</div>
    <button type="button" id="ship-edit-btn" class="ship-edit-btn">✏️ 修改</button>
  </div>

  <!-- 顯示態 -->
  <div id="ship-display" class="ship-display">
    <div><strong>收件人：</strong><span id="ship-name">{{ ship_name }}</span></div>
    <div><strong>電話：</strong><span id="ship-phone">{{ ship_phone }}</span></div>
    <div><strong>地址：</strong><span id="ship-address">{{ ship_addr }}</span></div>
    {% if not ship_name or not ship_phone or not ship_addr %}
      <div style="margin-top:6px;color:#a33;font-size:13px;">（目前資料未完整，請點「修改」補齊）</div>
    {% endif %}
  </div>

  <!-- 編輯態（預設隱藏） -->
  <form id="ship-form" style="display:none;margin-top:12px;">
    <div class="ship-grid">
      <div class="ship-field">
        <label>收件人</label>
        <input class="ship-input" name="name" required value="{{ ship_name }}" placeholder="收件人姓名">
      </div>
      <div class="ship-field">
        <label>電話</label>
        <input class="ship-input" name="phone" required value="{{ ship_phone }}" placeholder="聯絡電話">
      </div>
    </div>

    <div class="ship-field" style="margin-top:10px;">
      <label>地址</label>
      <input class="ship-input" name="address" required value="{{ ship_addr }}" placeholder="寄送地址">
    </div>

    <label class="ship-checkbox">
      <input type="checkbox" name="save_profile" value="1">
      同步更新到我的會員資料
    </label>

    <div class="ship-actions">
      <button type="submit" class="ship-btn-primary">💾 儲存</button>
      <button type="button" id="ship-cancel" class="ship-btn-secondary">取消</button>
    </div>
  </form>
</div>


    

  <script>
  (function(){
    const $btn = document.getElementById('ship-edit-btn');
    const $display = document.getElementById('ship-display');
    const $form = document.getElementById('ship-form');
    const $cancel = document.getElementById('ship-cancel');

    if (!$btn || !$display || !$form) return;

    function toEdit(){ $display.style.display = 'none';  $form.style.display = 'block'; }
    function toView(){ $form.style.display = 'none';     $display.style.display = 'block'; }

    $btn.addEventListener('click', toEdit);
    $cancel.addEventListener('click', toView);

    $form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData($form);
      const data = Object.fromEntries(fd.entries());

      if(!data.name || !data.phone || !data.address){
        alert('請完整填寫收件人 / 電話 / 地址');
        return;
      }

      try{
        const res = await fetch('/cart/address', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(data),
          credentials:'same-origin'
        });
        const j = await res.json();
        if(!j.ok) throw new Error(j.error || 'unknown');

        // 更新顯示
        document.getElementById('ship-name').textContent = data.name;
        document.getElementById('ship-phone').textContent = data.phone;
        document.getElementById('ship-address').textContent = data.address;
        toView();
      }catch(err){
        alert('儲存失敗，請稍後再試');
        console.error('[cart/address] error:', err);
      }
    });
  })();
  </script>
{% endif %}


      <div class="total">
  <div>商品總金額：${{ "{:,.0f}".format(total) }}</div>

  {# 折扣列（若有） #}
  {% if discount_deduct and discount_deduct > 0 %}
    <div>
      折扣碼 <span class="badge">{{ discount.code }}</span> 折抵：
      <span style="color:#e91e63;">－ ${{ "{:,.0f}".format(discount_deduct) }}</span>
    </div>
  {% endif %}

  {# 運費（在應付總金額上方） #}
  {% set threshold = free_shipping_threshold | default(0, true) %}
  {% set remain    = free_shipping_diff       | default(0, true) %}
  <div>
    運費：
    {% if shipping_fee == 0 %}
      免運費（已達 ${{ "{:,.0f}".format(threshold) }} 免運門檻）
    {% else %}
      ${{ "{:,.0f}".format(shipping_fee) }}（還差 ${{ "{:,.0f}".format(remain) }} 可享免運）
    {% endif %}
  </div>

  <div><strong>應付總金額：${{ "{:,.0f}".format(final_total) }}</strong></div>
</div>


      <form method="POST" action="/checkout">
        <button type="submit" class="checkout-btn">結帳</button>
      </form>
    {% else %}
      <p>目前尚無商品。</p>
    {% endif %}

    <a href="/" class="back-btn">← 繼續購物</a>
  </div>

  <script>
(function(){
  const scroller = document.getElementById('upsell-scroller');
  const prev = document.getElementById('upsell-prev');
  const next = document.getElementById('upsell-next');
  if (!scroller) return;

  // 左右箭頭：一次捲動 90% 寬
  function jump(dir){
    const w = scroller.clientWidth;
    scroller.scrollBy({ left: dir * Math.round(w * 0.9), behavior: 'smooth' });
  }
  prev && prev.addEventListener('click', () => jump(-1));
  next && next.addEventListener('click', () => jump(1));

  // 拖曳滑動（桌面也能拖）
  let isDown=false,startX,scrollLeft;
  scroller.addEventListener('pointerdown', e=>{
    isDown=true; startX=e.pageX; scrollLeft=scroller.scrollLeft; scroller.setPointerCapture(e.pointerId);
  });
  scroller.addEventListener('pointermove', e=>{
    if(!isDown) return; scroller.scrollLeft = scrollLeft - (e.pageX - startX);
  });
  ['pointerup','pointercancel','pointerleave'].forEach(ev=>{
    scroller.addEventListener(ev, ()=>{ isDown=false; });
  });
})();
</script>

</body>
</html>
