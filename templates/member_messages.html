{% extends "base.html" %}

{% block title %}æˆ‘çš„ç•™è¨€ - HERSET{% endblock %}
{% block banner %}{% endblock %}

{% block content %}
<div class="msg-wrap">
  <h2 class="msg-title">ğŸ“¨ æˆ‘çš„ç•™è¨€</h2>

  <!-- ç¯©é¸ Tabs -->
  <div class="msg-tabs">
    <a class="msg-tab {{ 'is-active' if (status|default('all'))=='all' else '' }}"
       href="{{ url_for('member_messages', status='all') }}">
      å…¨éƒ¨ <span class="msg-badge">{{ count_all|default(0) }}</span>
    </a>
    <a class="msg-tab {{ 'is-active' if status=='unreplied' else '' }}"
       href="{{ url_for('member_messages', status='unreplied') }}">
      æœªå›è¦† <span class="msg-badge">{{ count_unreplied|default(0) }}</span>
    </a>
    <a class="msg-tab {{ 'is-active' if status=='replied' else '' }}"
       href="{{ url_for('member_messages', status='replied') }}">
      å·²å›è¦† <span class="msg-badge">{{ count_replied|default(0) }}</span>
    </a>
  </div>

  {% if messages %}
    <div class="msg-list">
      {% for msg in messages %}
      <article class="msg-card {% if msg['type']=='ç³»çµ±é€šçŸ¥' %}is-system{% endif %}">
        <header class="msg-head">
          <div class="msg-type">{{ msg['type'] }}</div>
          <time class="msg-time">{{ msg['local_created_at'] }}</time>

          {% if msg['is_replied'] %}
            <span class="msg-chip is-done">å·²å›è¦†</span>
          {% else %}
            <span class="msg-chip is-pending">æœªå›è¦†</span>
          {% endif %}

          {% if msg['is_new'] %}
            <span class="msg-chip is-new">ğŸ”” æ–°å›è¦†</span>
          {% endif %}
        </header>

        <h3 class="msg-subject">{{ msg['subject'] }}</h3>

        {% if msg['order_number'] %}
        <div class="msg-row">
          <span class="msg-label">è¨‚å–®ç·¨è™Ÿ</span>
          <span class="msg-value">#{{ msg['order_number'] }}</span>
        </div>
        {% endif %}

        {% if msg['type'] != 'ç³»çµ±é€šçŸ¥' %}
<div class="msg-row">
  <span class="msg-label">ç•™è¨€å…§å®¹</span>
  <div class="msg-content">{{ msg['content'] }}</div>
</div>
{% endif %}


       {% if msg['is_replied'] %}
  <div class="msg-reply {% if msg['type']=='ç³»çµ±é€šçŸ¥' %}is-system{% endif %}">
    <div class="msg-reply-title">
      {% if msg['type']=='ç³»çµ±é€šçŸ¥' %}ğŸ“£ ç³»çµ±é€šçŸ¥{% else %}ç®¡ç†å“¡å›è¦†{% endif %}
    </div>
    {% set reply = msg['reply_text'] if msg['reply_text'] else msg['content'] %}
    <div class="msg-reply-body">{{ reply|trim or 'ï¼ˆç„¡å…§å®¹ï¼‰' }}</div>
  </div>
{% endif %}


  </article>
      {% endfor %}
    </div>

    <!-- åˆ†é  -->
    <div class="msg-pager">
      {% if has_prev %}
      <a class="pager-btn" href="{{ url_for('member_messages', page=page-1, status=status|default('all')) }}">â† ä¸Šä¸€é </a>
      {% else %}
      <span class="pager-btn is-disabled">â† ä¸Šä¸€é </span>
      {% endif %}

      {% if has_next %}
      <a class="pager-btn" href="{{ url_for('member_messages', page=page+1, status=status|default('all')) }}">ä¸‹ä¸€é  â†’</a>
      {% else %}
      <span class="pager-btn is-disabled">ä¸‹ä¸€é  â†’</span>
      {% endif %}
    </div>

  {% else %}
    <p class="msg-empty">ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„ç•™è¨€</p>
  {% endif %}
</div>

<style>
/* â€”â€” å¤–å±¤ â€”â€” */
.msg-wrap{max-width:920px;margin:40px auto 80px;padding:0 16px}
.msg-title{text-align:center;color:#c08474;font-weight:700;margin:0 0 14px}
.msg-tabs{display:flex;gap:10px;justify-content:center;margin:8px 0 22px}
.msg-tab{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid #eaded7;border-radius:999px;background:#fff;color:#6e5b52;text-decoration:none;font-weight:600}
.msg-tab:hover{background:#fbf7f5}
.msg-tab.is-active{background:#e8d7cf;border-color:#e8d7cf;color:#4b3a34}
.msg-badge{min-width:22px;height:22px;display:inline-flex;align-items:center;justify-content:center;padding:0 6px;border-radius:11px;background:#fff;color:#6e5b52;border:1px solid rgba(0,0,0,.06);font-size:12px}

/* â€”â€” å¡ç‰‡ â€”â€” */
.msg-list{display:flex;flex-direction:column;gap:16px}
.msg-card{background:#fff;border:1px solid #eee;border-radius:16px;padding:18px 20px;box-shadow:0 6px 20px rgba(0,0,0,.04)}
.msg-card:hover{box-shadow:0 10px 28px rgba(0,0,0,.07)}
.msg-head{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:8px}
.msg-type{padding:4px 10px;border-radius:999px;background:#f2ebe7;color:#6b564c;font-weight:700}
.msg-time{margin-left:auto;color:#9a867c;font-size:13px}
.msg-chip{padding:3px 10px;border-radius:999px;font-size:12px;font-weight:700;border:1px solid transparent}
.msg-chip.is-done{background:#e8f6ee;color:#2e7d32;border-color:#cfead9}
.msg-chip.is-pending{background:#fff6e5;color:#a15f00;border-color:#ffe2ad}
.msg-chip.is-new{background:#fff0f5;color:#c62828;border-color:#ffd6e2}
.msg-subject{margin:6px 0 10px;font-size:18px;color:#3b2f2a}
.msg-row{display:flex;gap:10px;align-items:flex-start;margin:8px 0}
.msg-label{flex:0 0 80px;color:#8a776f;font-weight:600}
.msg-value{color:#4b3a34}
.msg-content{white-space:pre-wrap;color:#3d312c;line-height:1.7}

.msg-reply{margin-top:12px;border-left:4px solid #c08474;background:#fdf7f5;border-radius:10px;padding:12px 14px}
.msg-reply-title{font-weight:700;color:#7e5b53;margin-bottom:6px}
.msg-reply-body{white-space:pre-wrap;color:#3b2f2a}

/* â€”â€” åˆ†é  â€”â€” */
.msg-pager{display:flex;justify-content:center;gap:10px;margin-top:22px}
.pager-btn{padding:10px 16px;border:1px solid #eaded7;border-radius:10px;background:#fff;text-decoration:none;color:#5a4841}
.pager-btn:hover{background:#fbf7f5}
.pager-btn.is-disabled{opacity:.5;pointer-events:none}
.msg-empty{text-align:center;color:#9a867c;margin:40px 0}
@media (max-width:560px){
  .msg-label{flex-basis:68px}
  .msg-time{width:100%;order:3;margin-left:0}
}

/* === ç³»çµ±é€šçŸ¥ï¼šå¡ç‰‡æ•´é«”é¡¯ç¤ºä¸åŒè‰²èª¿ === */
.msg-card.is-system{
  border-color:#b8d7ff;
  background:#f7fbff;
  position:relative;
}

/* å¯é¸çš„è§’è½å°æ¨™ç±¤ï¼ˆæƒ³è¦æ›´ä½èª¿å¯åˆªæ‰é€™æ®µï¼‰ */
.msg-card.is-system::before{
  content:"SYSTEM";
  position:absolute; top:12px; left:-8px;
  background:#0b63ce; color:#fff;
  font-size:11px; letter-spacing:.08em;
  padding:2px 6px; border-radius:4px;
  transform:rotate(-8deg);
  box-shadow:0 2px 6px rgba(0,0,0,.12);
}

/* å¡ç‰‡é ‚éƒ¨é¡å‹è† å›Šé¡è‰² */
.msg-card.is-system .msg-type{background:#e6f0ff;color:#0b63ce}

/* å›è¦†ï¼ˆé€šçŸ¥ï¼‰å€å¡Šé«˜äº® */
.msg-reply.is-system{
  border-left-color:#0b63ce;
  background:#eef6ff;
}
.msg-reply.is-system .msg-reply-title{color:#0b63ce}


</style>
{% endblock %}
