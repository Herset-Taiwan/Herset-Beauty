<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ­·å²è¨‚å–® - HERSET BEAUTY</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body { font-family: sans-serif; padding: 40px; background: #f4e8e4; }
    h2 { color: #5A4B45; margin-bottom: 20px; }
    .order-box {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 1px 5px rgba(0,0,0,0.1);
    }
    ul { padding-left: 20px; }
    .order-box strong { display: inline-block; width: 100px; }
    .back-btn {
      display: inline-block;
      margin-bottom: 30px;
      text-decoration: none;
      padding: 8px 16px;
      background: #e91e63;
      color: white;
      border-radius: 5px;
    }
    .order-section {
      margin-bottom: 50px;
    }
    .pagination {
      text-align: center;
      margin-top: 20px;
    }
    .pagination button {
      margin: 0 5px;
      padding: 5px 12px;
    }
  </style>
</head>
<body>

  <a href="/" class="back-btn">â† è¿”å›é¦–é </a>
  <h2>ğŸ§¾ æˆ‘çš„æ­·å²è¨‚å–®</h2>

  {% set pending_orders = orders | selectattr("status", "ne", "shipped") | list %}
  {% set completed_orders = orders | selectattr("status", "equalto", "shipped") | list %}

  <div class="order-section" id="pending-section">
    <h3>ğŸ“¦ å¾…å‡ºè²¨è¨‚å–®</h3>
    {% if pending_orders %}
      <div id="pending-orders"></div>
    {% else %}
      <p>ç›®å‰æ²’æœ‰å¾…å‡ºè²¨è¨‚å–®ã€‚</p>
    {% endif %}
  </div>

  <div class="order-section" id="completed-section">
    <h3>âœ… è¨‚å–®å·²å®Œæˆ</h3>
    {% if completed_orders %}
      <div id="completed-orders"></div>
    {% else %}
      <p>ç›®å‰æ²’æœ‰å·²å®Œæˆè¨‚å–®ã€‚</p>
    {% endif %}
  </div>

  <script>
    const pendingData = {{ pending_orders | tojson }};
    const completedData = {{ completed_orders | tojson }};
    const pageSize = 10;

    function translateStatus(status) {
      switch (status) {
        case 'pending': return 'å¾…è™•ç†';
        case 'paid': return 'å·²ä»˜æ¬¾';
        case 'shipped': return 'å·²å‡ºè²¨';
        default: return status;
      }
    }

    function renderOrders(data, containerId, page) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const pageData = data.slice(start, end);

      pageData.forEach(o => {
        const box = document.createElement('div');
        box.className = 'order-box';
        box.innerHTML = `
          <div><strong>è¨‚å–®ç·¨è™Ÿï¼š</strong>#${o.id}</div>
          <div><strong>è¨‚å–®æ™‚é–“ï¼š</strong>${o.created_local}</div>
          <div><strong>é‡‘é¡ï¼š</strong>$${o.total_amount}</div>
          <div><strong>ç‹€æ…‹ï¼š</strong>${translateStatus(o.status)}</div>
          <div><strong>å•†å“æ˜ç´°ï¼š</strong>
            <ul>
              ${o.items.map(i => `<li>${i.product_name} Ã— ${i.qty}ï¼ˆ$${i.price}ï¼‰</li>`).join('')}
            </ul>
          </div>
        `;
        container.appendChild(box);
      });

      const nav = document.createElement('div');
      nav.className = 'pagination';

      const totalPages = Math.ceil(data.length / pageSize);

      if (totalPages > 1) {
        const prev = document.createElement('button');
        prev.textContent = 'â† ä¸Šä¸€é ';
        prev.disabled = page === 1;
        prev.onclick = () => renderOrders(data, containerId, page - 1);

        const next = document.createElement('button');
        next.textContent = 'ä¸‹ä¸€é  â†’';
        next.disabled = page === totalPages;
        next.onclick = () => renderOrders(data, containerId, page + 1);

        const info = document.createElement('span');
        info.textContent = `ç¬¬ ${page} é  / å…± ${totalPages} é `;
        info.style.margin = '0 10px';

        nav.appendChild(prev);
        nav.appendChild(info);
        nav.appendChild(next);
        container.appendChild(nav);
      }
    }

    renderOrders(pendingData, 'pending-orders', 1);
    renderOrders(completedData, 'completed-orders', 1);
  </script>
</body>
</html>
