<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>æ­·å²è¨‚å–® - HERSET BEAUTY</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background-color: #f4e8e4;
    padding: 40px;
    color: #3C3C3C;
  }

  h2.center-title {
    text-align: center;
    color: #5A4B45;
    margin-bottom: 40px;
  }

  .back-btn {
    display: inline-block;
    background-color: #e91e63;
    color: #fff;
    padding: 10px 20px;
    border-radius: 30px;
    text-decoration: none;
    font-weight: bold;
    margin-bottom: 30px;
  }

  .order-box {
    background-color: #fff;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    margin-bottom: 30px;
    transition: transform 0.2s ease;
  }

  .order-box:hover {
    transform: scale(1.01);
  }

  .order-box .row {
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 8px;
  }

  .order-box .label {
  flex: 0 0 100px;
  font-weight: bold;
  margin-right: 10px;
  vertical-align: top;
}



  .order-box ul {
    padding-left: 24px;
    margin-top: 8px;
    color: #5A4B45;
  }

  .repay-btn {
    margin-top: 12px;
    padding: 10px 20px;
    background-color: #5A4B45;
    color: white;
    border: none;
    border-radius: 25px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.2s ease;
  }

  .repay-btn:hover {
    background-color: #7b5c54;
  }

  .pagination {
    text-align: center;
    margin-top: 20px;
  }

  .pagination button {
    margin: 0 5px;
    padding: 6px 14px;
    border-radius: 5px;
    border: none;
    background: #d6c1b4;
    color: #3C3C3C;
    font-weight: bold;
    cursor: pointer;
  }

  .pagination button:disabled {
    background-color: #eee;
    color: #aaa;
    cursor: default;
  }
</style>

</head>
<body>

  <a href="/" class="back-btn">â† è¿”å›é¦–é </a>
  <h2 class="center-title">ğŸ§¾ æˆ‘çš„æ­·å²è¨‚å–®</h2>

  {% set pending_orders = orders | selectattr("status", "ne", "shipped") | list %}
  {% set completed_orders = orders | selectattr("status", "equalto", "shipped") | list %}

  <div class="order-section" id="pending-section">
    <h3>ğŸ“¦ å¾…å‡ºè²¨è¨‚å–®</h3>
    {% if pending_orders %}
      <div id="pending-orders"></div>
    {% else %}
      <p>ç›®å‰æ²’æœ‰å¾…å‡ºè²¨è¨‚å–®ã€‚</p>
    {% endif %}
  </div>

  <div class="order-section" id="completed-section">
    <h3>âœ… è¨‚å–®å·²å®Œæˆ</h3>
    {% if completed_orders %}
      <div id="completed-orders"></div>
    {% else %}
      <p>ç›®å‰æ²’æœ‰å·²å®Œæˆè¨‚å–®ã€‚</p>
    {% endif %}
  </div>

  <script>
    const pendingData = {{ pending_orders | tojson }};
    const completedData = {{ completed_orders | tojson }};
    const pageSize = 10;

    function translateStatus(status) {
      switch (status) {
        case 'pending': return 'å¾…è™•ç†';
        case 'paid': return 'å·²ä»˜æ¬¾';
        case 'shipped': return 'å·²å‡ºè²¨';
        default: return status;
      }
    }

    function renderOrders(data, containerId, page) {
  const container = document.getElementById(containerId);
  container.innerHTML = '';
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  const pageData = data.slice(start, end);

  pageData.forEach(o => {
    const itemList = o.items.map(i => `<li>${i.product_name} Ã— ${i.qty}ï¼ˆ$${i.price}ï¼‰</li>`).join('');
    const itemSubtotal = o.items.reduce((sum, i) => sum + (i.price * i.qty), 0);
    const shipping = o.shipping_fee || 0;
    const finalAmount = o.total_amount;

    const box = document.createElement('div');
    box.className = 'order-box';
    box.innerHTML = `
  <!-- è¨‚å–®è³‡è¨Š -->
  <div class="row"><div class="label">è¨‚å–®ç·¨è™Ÿï¼š</div><div>#${o.id}</div></div>
  <div class="row"><div class="label">è¨‚å–®æ™‚é–“ï¼š</div><div>${o.created_local}</div></div>

  <br>

  <!-- å•†å“æ˜ç´° -->
  <div class="row">
    <div class="label">å•†å“æ˜ç´°ï¼š</div>
    <div>${o.items.map(i => `${i.product_name} Ã— ${i.qty}ï¼ˆ$${i.price}ï¼‰`).join('ã€')}</div>
  </div>

  <!-- é‡‘é¡ -->
  <div class="row"><div class="label">é‹è²»ï¼š</div><div>$${shipping}</div></div>
  <div class="row"><div class="label">ç¸½é‡‘é¡ï¼š</div><div><strong>$${finalAmount}</strong></div></div>

  <br>

  <!-- ç‹€æ…‹ -->
  <div class="row"><div class="label">ä»˜æ¬¾ç‹€æ…‹ï¼š</div><div>${o.payment_status === 'paid' ? 'å·²ä»˜æ¬¾' : 'æœªä»˜æ¬¾'}</div></div>
  <div class="row"><div class="label">å‡ºè²¨ç‹€æ…‹ï¼š</div><div>${translateStatus(o.status)}</div></div>

  ${o.payment_status !== 'paid' && o.MerchantTradeNo
    ? `<button class="repay-btn" onclick="goToPay('${o.MerchantTradeNo}')">ğŸ” é‡æ–°ä»˜æ¬¾</button>`
    : ''}
`;


  // åˆ†é æ§åˆ¶
  const nav = document.createElement('div');
  nav.className = 'pagination';
  const totalPages = Math.ceil(data.length / pageSize);

  if (totalPages > 1) {
    const prev = document.createElement('button');
    prev.textContent = 'â† ä¸Šä¸€é ';
    prev.disabled = page === 1;
    prev.onclick = () => renderOrders(data, containerId, page - 1);

    const next = document.createElement('button');
    next.textContent = 'ä¸‹ä¸€é  â†’';
    next.disabled = page === totalPages;
    next.onclick = () => renderOrders(data, containerId, page + 1);

    const info = document.createElement('span');
    info.textContent = `ç¬¬ ${page} é  / å…± ${totalPages} é `;
    info.style.margin = '0 10px';

    nav.appendChild(prev);
    nav.appendChild(info);
    nav.appendChild(next);
    container.appendChild(nav);
  }
}



    renderOrders(pendingData, 'pending-orders', 1);
    renderOrders(completedData, 'completed-orders', 1);
  </script>
  <script>
function goToPay(merchantTradeNo) {
  window.location.href = `/repay/${merchantTradeNo}`;
}
</script>

</body>
</html>
