{% extends "base.html" %}

{% block title %}HERSET å®˜æ–¹ç¶²ç«™ï½œå¤©ç„¶ä¿é¤Š Ã— å“å‘³ç”Ÿæ´»{% endblock %}

{% block banner %}
<!-- é¦–é è¼ªæ’­åœ–ï¼šåªåœ¨é¦–é é¡¯ç¤º -->
<div class="carousel-container">
  <div class="carousel">
    <img src="{{ url_for('static', filename='uploads/banner1.png') }}" class="carousel-img active">
    <img src="{{ url_for('static', filename='uploads/banner2.png') }}" class="carousel-img">
    <img src="{{ url_for('static', filename='uploads/banner3.jpg') }}" class="carousel-img">
    <img src="{{ url_for('static', filename='uploads/banner4.png') }}" class="carousel-img">
  </div>
  <div class="carousel-dots" id="carouselDots"></div>
</div>
{% endblock %}

{% block content %}
<!-- å•†å“è¦æ ¼æç¤º -->
<div class="spec-warning" id="spec-warning">è«‹é€²å…¥å•†å“é æŒ‘é¸è¦æ ¼</div>

<!-- å•†å“ç¼ºè²¨æç¤º -->
<div class="stock-warning" id="stock-warning">ç›®å‰å•†å“å·²å”®å®Œï¼Œè£œè²¨ä¸­</div>

<!-- å•†å“é¡¯ç¤ºå€å¡Š -->
<div id="product-list" class="product-grid" style="display:flex; flex-wrap:wrap; justify-content:center; gap:30px; margin-top:30px;"></div>




<!-- é¦–é æ¨™èªå€ -->
<section class="banner">
  <h1 id="banner-title">è‡ªç„¶å‘µè­·ï¼Œæ¥µè‡´ç´”æ·¨</h1>
  <p id="banner-desc">å°ˆç‚ºæ•æ„Ÿè‚Œè¨­è¨ˆçš„ç§å¯†ä¿é¤Šç³»åˆ—</p>
</section>

<!-- è£œå¡«æœƒå“¡è³‡æ–™æç¤º -->
{% if session.get('incomplete_profile') %}
<div id="incomplete-popup" class="modal" style="top: 30%; left: 50%; transform: translate(-50%, -50%);">
  <div class="modal-content" style="text-align:center;">
    <h3>è«‹è£œå……æœƒå“¡è³‡æ–™</h3>
    <p>è«‹è¼¸å…¥æ‚¨çš„å§“åã€é›»è©±èˆ‡åœ°å€ï¼Œä»¥ä¾¿é †åˆ©é…é€å•†å“ã€‚</p>
    <button onclick="document.getElementById('incomplete-popup').style.display='none'; openProfileModal()" style="
      padding: 10px 20px;
      background-color: #C6456C;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;">ç«‹å³è£œå¡«è³‡æ–™</button>
  </div>
</div>

{% endif %}


{% endblock %}

{% block script %}

<script>
async function loadProducts(category) {
  const response = await fetch(`/get_products?category=${encodeURIComponent(category)}`);
  const products = await response.json();

  const container = document.getElementById('product-list');
  container.innerHTML = ''; // æ¸…ç©ºèˆŠçš„

  if (products.length === 0) {
    container.innerHTML = `<div style="padding: 40px; text-align:center;">ğŸš« æŸ¥ç„¡å•†å“</div>`;
    return;
  }

  products.forEach(p => {
    const card = document.createElement('div');
    card.className = 'product-card';
    card.innerHTML = `
      <img src="${p.image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>$${p.price}</p>
      <button onclick="addToCart(event, ${p.id})">åŠ å…¥è³¼ç‰©è»Š</button>
    `;
    container.appendChild(card);
  });
}

// åˆå§‹è¼‰å…¥å…¨éƒ¨å•†å“
window.onload = () => loadProducts('å…¨éƒ¨');
</script>


<script>
document.addEventListener("DOMContentLoaded", () => {
  // é»æ“Šåˆ†é¡é¸å–®çš„äº‹ä»¶ç¶å®š
  document.querySelectorAll('.sub-categories a').forEach(el => {
    el.addEventListener('click', () => {
      const category = el.textContent.trim();
      filterCategory(category);
    });
  });


  // åˆå§‹åŒ–é è¨­åˆ†é¡
  filterCategory('å…¨éƒ¨å•†å“');
});

function filterCategory(category) {
  const all = document.querySelectorAll(".product-card");
  all.forEach(el => {
    const categories = (el.dataset.category || '').split(',').map(s => s.trim());
    if (category === 'å…¨éƒ¨å•†å“') {
  el.style.display = 'block';
} else {
  el.style.display = categories.includes(category) ? 'block' : 'none';
}

  });

  // æ›´æ–°æ¨™èªæ–‡å­—
  const bannerTitle = document.getElementById("banner-title");
  const bannerDesc = document.getElementById("banner-desc");

  switch (category) {
    case 'å…¨éƒ¨å•†å“':
      bannerTitle.textContent = 'è‡ªç„¶å‘µè­·ï¼Œæ¥µè‡´ç´”æ·¨';
      bannerDesc.textContent = 'å¾é ­åˆ°è…³çš„å…¨æ–¹ä½å‘µè­·ï¼Œä»»ä½ æŒ‘é¸';
      break;
    case 'èº«é«”ä¿é¤Š':
      bannerTitle.textContent = 'å–šé†’è‚Œè†šï¼Œæ»‹æ½¤æ¯ä¸€å¯¸';
      bannerDesc.textContent = 'çµ¦ä½ æœ€æº«å’Œç´°ç·»çš„èº«é«”ä¿é¤Šç³»åˆ—';
      break;
    case 'ç”Ÿæ´»é¦™æ°›':
      bannerTitle.textContent = 'è‡ªç„¶å‘µè­·ï¼Œæ¥µè‡´ç´”æ·¨';
      bannerDesc.textContent = 'ç”Ÿæ´»é¦™æ°›ç³»åˆ—';
      break;
    case 'å¯µç‰©å‹å–„':
      bannerTitle.textContent = 'å®‰å¿ƒé™ªä¼´ï¼Œæ¯›å­©æœ€æ‡‚ä½ ';
      bannerDesc.textContent = 'å¯µç‰©å‹å–„çš„å®‰å¿ƒä¿é¤Šé¸æ“‡';
      break;
    case 'å“ç‰Œåš´é¸':
      bannerTitle.textContent = 'ç²¾é¸å“ç‰Œï¼Œå“å‘³ç”Ÿæ´»';
      bannerDesc.textContent = 'åš´é¸å¤©ç„¶æˆåˆ†ï¼Œå®ˆè­·ä½ çš„æ—¥å¸¸';
      break;
    default:
      bannerTitle.textContent = 'HERSET';
      bannerDesc.textContent = '';
  }
}


// åŠ å…¥è³¼ç‰©è»ŠåŠŸèƒ½ï¼ˆåŠ å…¥è¦æ ¼åˆ¤æ–·ï¼‰
function addToCart(event, productId, optionCount = 0, stock = 0) {
  event.preventDefault();

  // å…ˆæª¢æŸ¥åº«å­˜
  if (stock <= 0) {
    const warning = document.getElementById("stock-warning");
    warning.style.display = "block";
    setTimeout(() => {
      warning.style.display = "none";
    }, 1500);
    return;
  }

  // è‹¥å•†å“è¦æ ¼è¶…éä¸€é …ï¼Œæç¤ºè«‹è‡³å•†å“é æŒ‘é¸
  if (optionCount >= 2) {
    const warning = document.getElementById("spec-warning");
    warning.style.display = "block";
    setTimeout(() => {
      warning.style.display = "none";
    }, 1500);
    return;
  }

  // å¦å‰‡ç…§åŸæœ¬æµç¨‹åŠ å…¥è³¼ç‰©è»Š
  fetch('/add_to_cart', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: 'product_id=' + productId
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      document.getElementById("cart-count").style.display = 'inline';
      document.getElementById("cart-count").textContent = data.count;
      const box = document.getElementById("add-success");
      box.style.display = 'block';
      setTimeout(() => { box.style.display = 'none'; }, 1500);
    }
  });
}



// è¼ªæ’­åœ–
// âœ… è¼ªæ’­åœ–ï¼ˆå«é»é»æ§åˆ¶ï¼‰
let cur = 0;
const banners = document.querySelectorAll('.carousel-img');
const dotContainer = document.getElementById('carouselDots');

function showBanner(index) {
  banners.forEach((img, i) => {
    img.classList.toggle('active', i === index);
  });
  document.querySelectorAll('#carouselDots span').forEach((dot, i) => {
    dot.classList.toggle('active', i === index);
  });
  cur = index;
}

function createDots() {
  dotContainer.innerHTML = '';
  banners.forEach((_, i) => {
    const dot = document.createElement('span');
    dot.className = 'carousel-dot' + (i === 0 ? ' active' : '');
    dot.addEventListener('click', () => {
      showBanner(i);
      resetAutoSlide();
    });
    dotContainer.appendChild(dot);
  });
}

function autoSlide() {
  cur = (cur + 1) % banners.length;
  showBanner(cur);
}

let autoInterval = setInterval(autoSlide, 5000);

function resetAutoSlide() {
  clearInterval(autoInterval);
  autoInterval = setInterval(autoSlide, 5000);
}

createDots();
showBanner(0);


// å•†å“è¦æ ¼æç¤ºè¦–çª—
function showSpecPopup() {
  document.getElementById("spec-popup").style.display = "block";
}

function closeSpecPopup() {
  document.getElementById("spec-popup").style.display = "none";
}

</script>
{% endblock %}
