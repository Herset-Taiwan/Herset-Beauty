<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>HERSET 管理後台</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1>HERSET 管理後台</h1>
    <nav>
      <a href="/admin">商品管理</a>
      <a href="/admin?tab=members">會員系統管理</a>
      <a href="/admin?tab=orders">訂單管理系統</a>
    </nav>
  </header>

  <main>
    <!-- 商品列表 -->
    {% if products %}
    <section>
      <h2>商品管理</h2>
      <a href="/admin/new" class="add-btn">＋新增商品</a>
      <ul>
        {% for p in products %}
        <li>
          {{ p.name }} - ${{ p.price }}
          <a href="/edit/{{ p.id }}">編輯</a>
          <form action="/delete/{{ p.id }}" method="post" style="display:inline;">
            <button type="submit">刪除</button>
          </form>
        </li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <!-- 會員列表 -->
    {% if members %}
    <section>
      <h2>會員系統管理</h2>
      <form method="get" action="/admin/members">
        <input type="text" name="keyword" placeholder="輸入帳號、姓名、電話或Email">
        <button type="submit">搜尋</button>
      </form>
      <ul>
        {% for m in members %}
        <li>
          <strong>{{ m.username }}</strong> ({{ m.account }})<br>
          電話：{{ m.phone or '—' }}、Email：{{ m.email or '—' }}
        </li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}

    <!-- 訂單列表 -->
    {% if orders %}
    <section>
      <h2>訂單管理系統</h2>
      {% for o in orders %}
      <div class="order-row">
        <strong>訂單編號：</strong>#{{ o.id }}<br>
        <strong>購買商品：</strong>
        <ul>
          {% for item in o.items %}
          <li>{{ item.product_name }} x {{ item.qty }} (${{ item.price }})</li>
          {% endfor %}
        </ul>
        <strong>訂單金額：</strong>${{ o.total_amount }}<br>
        <strong>會員帳號：</strong>{{ o.member.account }}<br>
        <strong>購買人：</strong>{{ o.member.name }}<br>
        <strong>電話：</strong>{{ o.member.phone }}<br>
        <strong>地址：</strong>{{ o.member.address }}<br>
        <strong>目前狀態：</strong>{{ o.status }}<br>
        <form action="/admin/orders/update_status/{{ o.id }}" method="post">
          <label>修改狀態：
            <select name="status">
              <option value="pending" {% if o.status == 'pending' %}selected{% endif %}>待處理</option>
              <option value="paid" {% if o.status == 'paid' %}selected{% endif %}>已付款</option>
              <option value="shipped" {% if o.status == 'shipped' %}selected{% endif %}>已出貨</option>
            </select>
          </label>
          <button type="submit">更新</button>
        </form>
        <form action="/admin/orders/delete/{{ o.id }}" method="post">
          <button type="submit">🗑 刪除</button>
        </form>
      </div>
      {% endfor %}
    </section>
    {% endif %}
  </main>

  <footer>
    <p>© 2025 HERSET 管理系統</p>
  </footer>
</body>
</html>
