<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>編輯套組 - HERSET BEAUTY</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/css/selectize.default.css" rel="stylesheet" />
  <style>
    form { max-width: 820px; margin: 36px auto; background:#fff; border:1px solid #eee; border-radius:12px; padding:24px 28px; }
    h2 { margin-top:0 }
    label { display:block; margin-top:12px; font-weight:700; }
    input[type="text"], input[type="number"], textarea, select {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box; margin-top:6px;
    }
    .row { display:flex; gap:16px; }
    .row > div { flex:1 }
    .note{color:#777; font-size:13px}
    .help{color:#9a877e; font-size:12px; margin-top:6px}
    .btn { background:#5E3C2C; color:#fff; border:none; border-radius:8px; padding:12px 16px; cursor:pointer; }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }
    hr{ border:none; border-top:1px solid #eee; margin:20px 0; }
  </style>
</head>
<body>

<form method="POST" action="/admin0363/bundles/{{ bundle['id'] }}/edit" enctype="multipart/form-data">
  <h2>編輯套組</h2>

  <label>套組名稱</label>
  <input type="text" name="name" value="{{ bundle['name'] }}" required>

  <!-- 套組名稱下方插入 -->
<label>分類（可多選）</label>
<select id="categories" name="categories[]" multiple placeholder="輸入後 Enter 可新增">
  {% for c in categories_all %}
    <option value="{{ c }}" {% if bundle.categories and c in bundle.categories %}selected{% endif %}>{{ c }}</option>
  {% endfor %}
</select>
<div class="help">例：身體保養、生活香氛、寵物友善、品牌嚴選、套組優惠…</div>

<label style="margin-top:12px;">標籤（可多選）</label>
<select id="tags" name="tags[]" multiple placeholder="輸入後 Enter 可新增">
  {% for t in tags_all %}
    <option value="{{ t }}">{{ t }}</option>
  {% endfor %}
</select>
<div class="help">例：新品優惠、主打商品、熱銷推薦、限量販售、天然成分…</div>


  <div class="row">
    <div>
      <label>套組售價（必填）</label>
      <input type="number" name="price" min="0" step="1" value="{{ bundle['price'] }}" required>
    </div>
    <div>
      <label>顯示原價（選填）</label>
      <input type="number" name="compare_at" min="0" step="1" value="{{ bundle['compare_at'] or '' }}">
    </div>
    <div>
      <label>套組庫存（必填）</label>
      <input type="number" name="stock" min="0" step="1" value="{{ bundle['stock'] or 0 }}" required>
    </div>
  </div>

  <div class="row">
    <div>
      <label>應選商品數量（0＝不用逐步挑選）</label>
      <input type="number" name="required_total" min="0" step="1" value="{{ bundle['required_total'] or 0 }}">
      <div class="help">
        例：設為 3，前台會引導消費者依序挑滿 3 樣；若上方「可選商品池」只有 1 樣商品，會顯示該商品並帶入其附加選項（如口味）讓消費者選。
      </div>
    </div>
  </div>

  <label>封面圖（若不更換可略過）</label>
  <input type="file" name="cover_image" accept="image/*">
  {% if bundle['cover_image'] %}
    <div class="note">目前封面：<a href="{{ bundle['cover_image'] }}" target="_blank">查看</a></div>
  {% endif %}

  <label>後台備註／描述（選填）</label>
  <textarea name="description" rows="3">{{ bundle['description'] or '' }}</textarea>

  <hr>

  <label>可選商品池（可多選，僅顯示單品）</label>
  <select id="pool" name="pool_ids[]" multiple>
    {% for p in products %}
      <option value="{{ p['id'] }}" {% if p['id'] in pool_ids %}selected{% endif %}>
        #{{ p['id'] }}｜{{ p['name'] }}（$ {{ p['price'] }}）
      </option>
    {% endfor %}
  </select>
  <div class="note">
    前台會從這個池子顯示商品供消費者挑選；若池子僅 1 樣商品，會直接顯示該商品並帶出附加選項（如口味）讓消費者選擇。
  </div>

  <div style="margin-top:24px;">
    <button class="btn" type="submit" style="width:100%;">儲存變更</button>
  </div>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/js/standalone/selectize.min.js"></script>
<script>
  $('#pool').selectize({ plugins:['remove_button'], persist:false, delimiter:',', create:false });
</script>

<script>
  $('#pool').selectize({ plugins:['remove_button'], persist:false, delimiter:',', create:false });

  // 新增：分類、標籤多選＋可新增
  $('#categories').selectize({ plugins:['remove_button'], persist:false, create:true });
  $('#tags').selectize({ plugins:['remove_button'], persist:false, create:true });
</script>

</body>
</html>
