<div class="tab-inner"></div>
<a href="/admin/new" class="add-btn">ï¼‹ æ–°å¢å•†å“</a>
{% if products %}
  {% for p in products %}
    <div class="product-row" data-categories="{{ ','.join(p['categories']) if p.get('categories') else '' }}">
      <img src="{{ p['image'] or '' }}" alt="{{ p['name'] }}">
      <div class="info">
        <strong>{{ p['name'] or 'ç„¡åç¨±' }}</strong><br>
        {% if p.get('discount_price') %}
          åƒ¹æ ¼ï¼š<span style="text-decoration: line-through; color: #888;">${{ p['price'] }}</span>
               <span style="color: red; font-weight: bold; margin-left: 5px;">${{ p['discount_price'] }}</span><br>
        {% else %}
          åƒ¹æ ¼ï¼š${{ p['price'] }}<br>
        {% endif %}
        {% if p['stock'] == 0 %}
          <span style="color: red; font-weight: bold;">å·²å”®å®Œ</span>
        {% else %}
          ç›®å‰åº«å­˜ï¼š{{ p['stock'] or 0 }}
        {% endif %}
      </div>
      <div class="actions">
        <a href="/edit/{{ p['id'] }}">âœï¸ ç·¨è¼¯</a>
        <form action="/delete/{{ p['id'] }}" method="post" style="display:inline;" onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤å•†å“ï¼Ÿ')">
          <button type="submit" style="color: #e91e63; border: none; background: none; cursor: pointer;">ğŸ—‘ï¸ åˆªé™¤</button>
        </form>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p style="color: gray;">ç›®å‰æ²’æœ‰ä»»ä½•å•†å“</p>
{% endif %}

<!-- ğŸ” åˆ†é¡æœå°‹ -->
<div style="margin-bottom: 20px;">
  <label>åˆ†é¡ç¯©é¸ï¼š</label>
  <select id="categoryFilter" multiple>
    {% set all_categories = ['èº«é«”ä¿é¤Š', 'ç§å¯†ä¿é¤Š', 'å¯µç‰©å‹å–„', 'å“ç‰Œåš´é¸'] %}
    {% for cat in all_categories %}
      <option value="{{ cat }}">{{ cat }}</option>
    {% endfor %}
  </select>
  <button type="button" onclick="filterProducts()">æœå°‹</button>
</div>

<!-- Selectize æ¨£å¼ + JS -->
<link href="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/css/selectize.default.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/js/standalone/selectize.min.js"></script>


<script>
function filterProducts() {
  const selected = $('#categoryFilter').val(); // Selectize multiple
  if (!selected || selected.length === 0) {
    document.querySelectorAll('.product-row').forEach(p => p.style.display = 'flex');
    return;
  }

  document.querySelectorAll('.product-row').forEach(p => {
    const categories = p.getAttribute('data-categories') || '';
    const matched = selected.some(cat => categories.includes(cat));
    p.style.display = matched ? 'flex' : 'none';
  });
}

// åˆå§‹åŒ– Selectize
$(function () {
  $('#categoryFilter').selectize({
    plugins: ['remove_button'],
    delimiter: ',',
    persist: false
  });
});
</script>
