<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>購物金發放 - HERSET 後台</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* ── Topbar 與導覽（與上一頁一致） ───────────────────────── */
    .admin-topbar{
      position:relative;
      display:flex;
      align-items:center;
      gap:10px;
      padding:12px 16px;
      background:#f7f2f1;
      border-bottom:1px solid #e6d6d2;
      /* 不要 space-between，避免只有一個子項時被推到左側 */
    }
    /* 置中膠囊選單 */
    .admin-topbar .nav{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      display:flex;
      gap:10px;
    }
    .admin-topbar .nav a{
      display:inline-block;
      background:#fff;
      border:1px solid #e5d3cf;
      border-radius:999px;
      padding:8px 14px;
      text-decoration:none;
      color:#5a4b45;
    }
    /* 右側按鈕群靠右 */
    .admin-topbar .actions{
      margin-left:auto;
      display:flex;
      gap:10px;
    }
    .btn{display:inline-block;padding:8px 14px;border-radius:999px;border:1px solid #d9c6c2;cursor:pointer;background:#fff;color:#5a4b45;text-decoration:none}
    .btn-primary{background:#c6456c;color:#fff;border:none;border-radius:8px}

    /* 小螢幕避免重疊：導覽回到正常流並置中 */
    @media (max-width: 768px){
      .admin-topbar{flex-wrap:wrap}
      .admin-topbar .nav{position:static;transform:none;margin:6px auto 0}
      .admin-topbar .actions{width:100%;justify-content:flex-end}
    }

    /* ── 頁面原有樣式 ─────────────────────────────────── */
    .container{max-width:1100px;margin:20px auto;padding:0 16px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border:1px solid #eadad6;padding:8px 10px;text-align:left}
    .form-inline{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px}
    .card{background:#fff;border:1px solid #eadad6;border-radius:12px;padding:16px}

    .flash-area{margin:0 0 12px}
    .alert{padding:10px 12px;border-radius:8px;border:1px solid transparent}
    .alert.success{background:#ecfdf5;border-color:#10b98133;color:#065f46}
    .alert.warning{background:#fffbeb;border-color:#f59e0b33;color:#92400e}
    .alert.error{background:#fef2f2;border-color:#ef444433;color:#991b1b}
  </style>
</head>
<body>

  <div class="admin-topbar">
    <!-- 中央膠囊選單 -->
    <div class="nav">
      <a href="/admin0363/wallet/grant">購物金發放</a>
      <a href="/admin0363/wallet/report">購物金報表</a>
      <a href="/admin0363/wallet/settings">購物金設定</a>
    </div>
    <!-- 右側動作 -->
    <div class="actions">
      <a class="btn" href="/admin0363/features">功能管理</a>
      <a class="btn" href="/admin0363/dashboard">返回後台</a>
      <a class="btn" href="/admin0363/logout">登出</a>
    </div>
  </div>

  <div class="container">
    <h2 style="margin:0 0 16px;">發放購物金</h2>
    {% with flashes = get_flashed_messages(with_categories=True) %}
      {% if flashes %}
        <div class="flash-area">
          {% for cat, msg in flashes %}
            <div class="alert {{ cat }}">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="card">
      <form method="get" class="form-inline" action="/admin0363/wallet/grant">
        <label style="flex:1 1 280px;">搜尋會員（email / 姓名 / 電話）
          <input type="text" name="q" value="{{ request.args.get('q','') }}" placeholder="輸入關鍵字後按搜尋">
        </label>
        <button class="btn">搜尋</button>
        <a class="btn" href="/admin0363/features">返回</a>
      </form>

      {% if candidates and candidates|length > 0 %}
      <table class="table">
        <thead>
          <tr>
            <th>會員</th>
            <th>Email</th>
            <th>電話</th>
            <th style="width:420px;">發放</th>
          </tr>
        </thead>
        <tbody>
        {% for m in candidates %}
          <tr>
            <td>#{{ m.id }} {{ m.name or '' }}</td>
            <td>{{ m.email or '' }}</td>
            <td>{{ m.phone or '' }}</td>
            <td>
              <form method="post" class="form-inline" style="align-items:center;">
                <input type="hidden" name="member_id" value="{{ m.id }}">
                <input type="number" name="amount" placeholder="金額(元)" min="1" required style="width:120px;">
                <input type="date" name="expires_at" placeholder="到期日（可空）" style="width:170px;">
                <input type="text" name="note" placeholder="備註" style="flex:1 1 160px;">
                <button class="btn btn-primary">發放</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
      {% else %}
        {% if request.args.get('q') %}
          <div style="color:#999;">找不到符合條件的會員。</div>
        {% else %}
          <div style="color:#999;">請先上方搜尋會員。</div>
        {% endif %}
      {% endif %}
    </div>
  </div>

</body>
</html>
